<!DOCTYPE html><html lang="en" class="charm" data-astro-cid-o3f7wajd> <head><meta charset="utf-8"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="viewport" content="width=device-width"><meta name="generator" content="Astro v5.2.6"><style is:global>
    @font-face {
      font-family: 'LXGW ZhenKai';
      src: url('https://static.zeoseven.com/zsft/2/main.woff2') format('woff2'),
          url('https://static-host.zeoseven.com/zsft/2/main.woff2') format('woff2');
      unicode-range: U+0061-007A, U+0041-005A, U+0030-0039, U+002E, U+002C, U+0021, U+003F, U+003A, U+003B, U+002D;
    }
  </style><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.BOel_0Ki.js"></script><script>
"use strict";(()=>{(()=>{let t="theme-toggle",n;function r(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function l(){let e=localStorage.getItem(t);return e==="dark"||e==="light"?e:null}function m(){return n||l()||r()}function s(e){e===r()?localStorage.removeItem(t):localStorage.setItem(t,e)}function h(e){let o=document.documentElement;o.classList.toggle("dark",e==="dark"),o.dataset.theme=e,o.style.colorScheme=e}function a(e){n=e,s(e),h(e)}function c(){a(m())}c(),document.addEventListener("astro:after-swap",c),window.astroThemeToggle={setTheme:a,getTheme:m}})();})();
</script><title>使用 ngrok 实现内网穿透（自建 ngrok 服务器） | Title on home page</title><link rel="canonical" href="https://blog.gkzhb.top/posts/ngrok/"><meta name="description" content="Description on home page"><meta name="robots" content="index, follow"><link rel="alternate" title="使用 ngrok 实现内网穿透（自建 ngrok 服务器） | Title on home page" href="/rss.xml" type="application/rss+xml"><script type="module">const c="1.2.1",o={bg:"background: #fcfaf2;",block:"display: inline-block; padding: 2px 6px;",badge:"color: #fcfaf2; background: #e06458;",text:"color: #374151;",arrow:"color: #212121;",link:"color: #e06458; text-decoration: underline;"};console.info(`%c Charm Theme  %cv${c} %c
%c→%cGithub: %chttps://github.com/Yuhanawa/astro-charm`,`${o.block} ${o.badge} font-weight: bold;`,`${o.block} ${o.bg} ${o.text} opacity: 0.8;`,o.bg,`${o.block} ${o.bg} ${o.arrow}`,`${o.block} ${o.bg} ${o.text}`,`${o.block} ${o.bg} ${o.link}`);</script><style>:where(#astro-theme-toggle){padding:0;margin:0;border:none;background:none;cursor:pointer;width:100%;height:100%}.astro-theme-toggle-icon-light,.astro-theme-toggle-icon-dark{width:100%;height:100%;& *{display:block}}.astro-theme-toggle-icon-light{display:block;.dark &{display:none}}.astro-theme-toggle-icon-dark{display:none;.dark &{display:block}}
</style>
<link rel="stylesheet" href="/_astro/_special_.BPu38SJZ.css"><script type="module" src="/_astro/page.CPvyyiTs.js"></script></head> <body data-astro-cid-o3f7wajd> <main data-astro-cid-o3f7wajd>  <div class="mobile-menu-container" data-astro-cid-2yeyokk7> <header class="mobile-header" data-astro-cid-2yeyokk7> <a class="title" title="gkzhb's blog" href="/" data-astro-cid-2yeyokk7>gkzhb&#39;s blog</a> <button class="menu-toggle" aria-label="Toggle menu" data-astro-cid-2yeyokk7> <svg width="1em" height="1em" class="menu-icon" data-astro-cid-2yeyokk7="true" data-icon="solar:hamburger-menu-bold-duotone">   <symbol id="ai:solar:hamburger-menu-bold-duotone" viewBox="0 0 24 24"><path fill="currentColor" d="M12 22c-4.714 0-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12s0-7.071 1.464-8.536C4.93 2 7.286 2 12 2s7.071 0 8.535 1.464C22 4.93 22 7.286 22 12s0 7.071-1.465 8.535C19.072 22 16.714 22 12 22" opacity=".5"/><path fill="currentColor" d="M18.75 8a.75.75 0 0 1-.75.75H6a.75.75 0 0 1 0-1.5h12a.75.75 0 0 1 .75.75m0 4a.75.75 0 0 1-.75.75H6a.75.75 0 0 1 0-1.5h12a.75.75 0 0 1 .75.75m0 4a.75.75 0 0 1-.75.75H6a.75.75 0 0 1 0-1.5h12a.75.75 0 0 1 .75.75"/></symbol><use href="#ai:solar:hamburger-menu-bold-duotone"></use>  </svg> </button> </header> <nav class="mobile-menu" data-astro-cid-2yeyokk7> <div class="menu-content" data-astro-cid-2yeyokk7> <ul class="nav-list" data-astro-cid-2yeyokk7> <li style="animation-delay: 0.2s;" data-astro-cid-2yeyokk7> <a href="/" title="Home" data-astro-prefetch="viewport" data-astro-cid-2yeyokk7> <div class="icon-state-wrapper" data-active="false" data-astro-cid-272faz54><svg width="1em" height="1em" viewBox="0 0 24 24" class="icon default icon" data-astro-cid-2yeyokk7="true" data-astro-cid-272faz54="true" data-astro-cid-bfoveg4b="true" data-icon="solar:file-text-broken">   <use href="#ai:solar:file-text-broken"></use>  </svg><svg width="1em" height="1em" viewBox="0 0 24 24" class="icon hover icon" data-astro-cid-2yeyokk7="true" data-astro-cid-272faz54="true" data-astro-cid-bfoveg4b="true" data-icon="solar:file-smile-outline">   <use href="#ai:solar:file-smile-outline"></use>  </svg><svg width="1em" height="1em" viewBox="0 0 24 24" class="icon active icon" data-astro-cid-2yeyokk7="true" data-astro-cid-272faz54="true" data-astro-cid-bfoveg4b="true" data-icon="solar:file-smile-bold-duotone">   <use href="#ai:solar:file-smile-bold-duotone"></use>  </svg></div> <span data-astro-cid-2yeyokk7>Home</span> </a> </li> <li style="animation-delay: 0.30000000000000004s;" data-astro-cid-2yeyokk7> <a href="/about" title="About" data-astro-prefetch="viewport" data-astro-cid-2yeyokk7> <div class="icon-state-wrapper" data-active="false" data-astro-cid-272faz54><svg width="1em" height="1em" viewBox="0 0 24 24" class="icon default icon" data-astro-cid-2yeyokk7="true" data-astro-cid-272faz54="true" data-astro-cid-bfoveg4b="true" data-icon="solar:ghost-broken">   <use href="#ai:solar:ghost-broken"></use>  </svg><svg width="1em" height="1em" viewBox="0 0 24 24" class="icon hover icon" data-astro-cid-2yeyokk7="true" data-astro-cid-272faz54="true" data-astro-cid-bfoveg4b="true" data-icon="solar:ghost-smile-outline">   <use href="#ai:solar:ghost-smile-outline"></use>  </svg><svg width="1em" height="1em" viewBox="0 0 24 24" class="icon active icon" data-astro-cid-2yeyokk7="true" data-astro-cid-272faz54="true" data-astro-cid-bfoveg4b="true" data-icon="solar:ghost-smile-bold-duotone">   <use href="#ai:solar:ghost-smile-bold-duotone"></use>  </svg></div> <span data-astro-cid-2yeyokk7>About</span> </a> </li> </ul> <div class="social-links" data-astro-cid-2yeyokk7> <a href="https://github.com/gkzhb" title="GitHub" class="social-link" style="animation-delay: 0.5s;" data-astro-cid-2yeyokk7> <svg width="1em" height="1em" viewBox="0 0 24 24" class="icon" data-astro-cid-2yeyokk7="true" data-icon="simple-icons:github">   <use href="#ai:simple-icons:github"></use>  </svg> <span data-astro-cid-2yeyokk7>GitHub</span> </a> </div> </div> </nav> </div> <br data-astro-cid-2yeyokk7>  <script data-astro-rerun>
  document.querySelector(".menu-toggle")?.addEventListener("click", () => {
    const mobileMenu = document.querySelector(".mobile-menu");
    const menuIcon = document.querySelector(".menu-icon");

    mobileMenu?.classList.toggle("active");
    menuIcon?.classList.toggle("active");
    document.body.style.overflow = mobileMenu?.classList.contains("active")
      ? "hidden"
      : "";
  });

  document.addEventListener("click", (event) => {
    if (
      event.target instanceof Element &&
      !event.target.closest(".mobile-menu") &&
      !event.target.closest(".menu-toggle")
    ) {
      const mobileMenu = document.querySelector(".mobile-menu");
      const menuIcon = document.querySelector(".menu-icon");

      mobileMenu?.classList.remove("active");
      menuIcon?.classList.remove("active");
      document.body.style.overflow = "";
    }
  });
</script> <div class="side" data-astro-cid-jalpcphr> <div class="container" data-astro-cid-jalpcphr> <div class="shooting-star-container" aria-hidden="true" aria-label="shooting stars animation" data-astro-cid-eggminjp style="--shootingTime: 3000ms;--starColor: var(--charm-highlight-color);--starTailColor: rgba(0, 0, 255, 0);"> <div class="night" data-astro-cid-eggminjp style="--shootingTime: 3000ms;--starColor: var(--charm-highlight-color);--starTailColor: rgba(0, 0, 255, 0);"> <div class="shooting-star" style="--index: 1; --delay: 6943ms; --top-offset: 193px; --left-offset: 126px;; --shootingTime: 3000ms;--starColor: var(--charm-highlight-color);--starTailColor: rgba(0, 0, 255, 0);" data-astro-cid-eggminjp></div><div class="shooting-star" style="--index: 2; --delay: 8972ms; --top-offset: -109px; --left-offset: 55px;; --shootingTime: 3000ms;--starColor: var(--charm-highlight-color);--starTailColor: rgba(0, 0, 255, 0);" data-astro-cid-eggminjp></div><div class="shooting-star" style="--index: 3; --delay: 3469ms; --top-offset: -90px; --left-offset: 240px;; --shootingTime: 3000ms;--starColor: var(--charm-highlight-color);--starTailColor: rgba(0, 0, 255, 0);" data-astro-cid-eggminjp></div><div class="shooting-star" style="--index: 4; --delay: 7275ms; --top-offset: -183px; --left-offset: 66px;; --shootingTime: 3000ms;--starColor: var(--charm-highlight-color);--starTailColor: rgba(0, 0, 255, 0);" data-astro-cid-eggminjp></div><div class="shooting-star" style="--index: 5; --delay: 9231ms; --top-offset: -106px; --left-offset: 45px;; --shootingTime: 3000ms;--starColor: var(--charm-highlight-color);--starTailColor: rgba(0, 0, 255, 0);" data-astro-cid-eggminjp></div> </div> </div>  <div class="center" data-astro-cid-jalpcphr> <nav data-astro-cid-jalpcphr> <a href="/" title="Home" data-astro-prefetch="viewport" data-astro-cid-jalpcphr> <div class="item" data-astro-cid-jalpcphr> <span class="title transparent" data-astro-cid-jalpcphr> Home </span> <div class="icon-state-wrapper" data-active="false" data-astro-cid-272faz54><svg width="1em" height="1em" data-astro-cid-jalpcphr="true" class="icon default icon" data-astro-cid-272faz54="true" data-astro-cid-bfoveg4b="true" data-icon="solar:file-text-broken">   <symbol id="ai:solar:file-text-broken" viewBox="0 0 24 24"><g fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-width="1.5" d="M6 14.5h8M6 18h5.5"/><path stroke="currentColor" stroke-width="1.5" d="M13 2.5V5c0 2.357 0 3.536.732 4.268S15.643 10 18 10h4"/><path fill="currentColor" d="M2.75 10a.75.75 0 0 0-1.5 0zm18.5 4a.75.75 0 0 0 1.5 0zm-5.857-9.946l-.502.557zm3.959 3.563l-.502.557zm2.302 2.537l-.685.305zM3.172 20.828l.53-.53zm17.656 0l-.53-.53zM1.355 5.927a.75.75 0 0 0 1.493.146zm21.29 12.146a.75.75 0 1 0-1.493-.146zM14 21.25h-4v1.5h4zM2.75 14v-4h-1.5v4zm18.5-.437V14h1.5v-.437zM14.891 4.61l3.959 3.563l1.003-1.115l-3.958-3.563zm7.859 8.952c0-1.689.015-2.758-.41-3.714l-1.371.61c.266.598.281 1.283.281 3.104zm-3.9-5.389c1.353 1.218 1.853 1.688 2.119 2.285l1.37-.61c-.426-.957-1.23-1.66-2.486-2.79zM10.03 2.75c1.582 0 2.179.012 2.71.216l.538-1.4c-.852-.328-1.78-.316-3.248-.316zm5.865.746c-1.086-.977-1.765-1.604-2.617-1.93l-.537 1.4c.532.204.98.592 2.15 1.645zM10 21.25c-1.907 0-3.261-.002-4.29-.14c-1.005-.135-1.585-.389-2.008-.812l-1.06 1.06c.748.75 1.697 1.081 2.869 1.239c1.15.155 2.625.153 4.489.153zM1.25 14c0 1.864-.002 3.338.153 4.489c.158 1.172.49 2.121 1.238 2.87l1.06-1.06c-.422-.424-.676-1.004-.811-2.01c-.138-1.027-.14-2.382-.14-4.289zM14 22.75c1.864 0 3.338.002 4.489-.153c1.172-.158 2.121-.49 2.87-1.238l-1.06-1.06c-.424.422-1.004.676-2.01.811c-1.027.138-2.382.14-4.289.14zm-3.97-21.5c-1.875 0-3.356-.002-4.511.153c-1.177.158-2.129.49-2.878 1.238l1.06 1.06c.424-.422 1.005-.676 2.017-.811c1.033-.138 2.395-.14 4.312-.14zM2.848 6.073c.121-1.234.382-1.9.854-2.371l-1.06-1.06c-.836.834-1.153 1.919-1.287 3.285zm18.304 11.854c-.121 1.234-.383 1.9-.854 2.371l1.06 1.06c.836-.834 1.153-1.919 1.287-3.285z"/></g></symbol><use href="#ai:solar:file-text-broken"></use>  </svg><svg width="1em" height="1em" data-astro-cid-jalpcphr="true" class="icon hover icon" data-astro-cid-272faz54="true" data-astro-cid-bfoveg4b="true" data-icon="solar:file-smile-outline">   <symbol id="ai:solar:file-smile-outline" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M12.25 2.834c-.46-.078-1.088-.084-2.22-.084c-1.917 0-3.28.002-4.312.14c-1.012.135-1.593.39-2.016.812s-.677 1.003-.812 2.009c-.138 1.028-.14 2.382-.14 4.29v4c0 1.906.002 3.26.14 4.288c.135 1.006.389 1.586.812 2.01c.423.422 1.003.676 2.009.811c1.028.139 2.382.14 4.289.14h4c1.907 0 3.262-.002 4.29-.14c1.005-.135 1.585-.389 2.008-.812s.677-1.003.812-2.009c.138-1.027.14-2.382.14-4.289v-.437c0-1.536-.01-2.264-.174-2.813h-3.13c-1.133 0-2.058 0-2.79-.098c-.763-.103-1.425-.325-1.954-.854s-.751-1.19-.854-1.955c-.098-.73-.098-1.656-.098-2.79zm1.5.776V5c0 1.2.002 2.024.085 2.643c.08.598.224.891.428 1.094s.496.348 1.094.428c.619.083 1.443.085 2.643.085h2.02a46 46 0 0 0-1.17-1.076l-3.959-3.563A37 37 0 0 0 13.75 3.61m-3.575-2.36c1.385 0 2.28 0 3.103.315c.823.316 1.485.912 2.51 1.835l.107.096l3.958 3.563l.125.112c1.184 1.065 1.95 1.754 2.361 2.678s.412 1.954.411 3.546v.661c0 1.838 0 3.294-.153 4.433c-.158 1.172-.49 2.121-1.238 2.87c-.749.748-1.698 1.08-2.87 1.238c-1.14.153-2.595.153-4.433.153H9.944c-1.838 0-3.294 0-4.433-.153c-1.172-.158-2.121-.49-2.87-1.238c-.748-.749-1.08-1.698-1.238-2.87c-.153-1.14-.153-2.595-.153-4.433V9.945c0-1.838 0-3.294.153-4.433c.158-1.172.49-2.121 1.238-2.87c.75-.749 1.701-1.08 2.878-1.238c1.144-.153 2.607-.153 4.455-.153h.202" clip-rule="evenodd"/><path fill="currentColor" d="M18 14.5c0 .829-.448 1.5-1 1.5s-1-.671-1-1.5c0-.828.448-1.5 1-1.5s1 .672 1 1.5"/><path fill="currentColor" fill-rule="evenodd" d="M8.376 17.084a.75.75 0 0 1 1.04-.208a4.66 4.66 0 0 0 5.168 0a.75.75 0 1 1 .832 1.248a6.16 6.16 0 0 1-6.832 0a.75.75 0 0 1-.208-1.04" clip-rule="evenodd"/><path fill="currentColor" d="M8 14.5c0 .829-.448 1.5-1 1.5s-1-.671-1-1.5c0-.828.448-1.5 1-1.5s1 .672 1 1.5"/></symbol><use href="#ai:solar:file-smile-outline"></use>  </svg><svg width="1em" height="1em" data-astro-cid-jalpcphr="true" class="icon active icon" data-astro-cid-272faz54="true" data-astro-cid-bfoveg4b="true" data-icon="solar:file-smile-bold-duotone">   <symbol id="ai:solar:file-smile-bold-duotone" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M14 22h-4c-3.771 0-5.657 0-6.828-1.172S2 17.771 2 14v-4c0-3.771 0-5.657 1.172-6.828S6.239 2 10.03 2c.606 0 1.091 0 1.5.017q-.02.12-.02.244l-.01 2.834c0 1.097 0 2.067.105 2.848c.114.847.375 1.694 1.067 2.386c.69.69 1.538.952 2.385 1.066c.781.105 1.751.105 2.848.105h4.052c.043.534.043 1.19.043 2.063V14c0 3.771 0 5.657-1.172 6.828S17.771 22 14 22" clip-rule="evenodd" opacity=".5"/><path fill="currentColor" d="M8 14.5c0 .828-.448 1.5-1 1.5s-1-.672-1-1.5s.448-1.5 1-1.5s1 .672 1 1.5m1.416 2.376a.75.75 0 0 0-.832 1.248a6.16 6.16 0 0 0 6.832 0a.75.75 0 1 0-.832-1.248a4.66 4.66 0 0 1-5.168 0M18 14.5c0 .828-.448 1.5-1 1.5s-1-.672-1-1.5s.448-1.5 1-1.5s1 .672 1 1.5M11.51 2.26l-.01 2.835c0 1.097 0 2.066.105 2.848c.114.847.375 1.694 1.067 2.385c.69.691 1.538.953 2.385 1.067c.781.105 1.751.105 2.848.105h4.052q.02.232.028.5H22c0-.268 0-.402-.01-.56a5.3 5.3 0 0 0-.958-2.641c-.094-.128-.158-.204-.285-.357C19.954 7.494 18.91 6.312 18 5.5c-.81-.724-1.921-1.515-2.89-2.161c-.832-.556-1.248-.834-1.819-1.04a6 6 0 0 0-.506-.154c-.384-.095-.758-.128-1.285-.14z"/></symbol><use href="#ai:solar:file-smile-bold-duotone"></use>  </svg></div> </div> </a> <a href="/about" title="About" data-astro-prefetch="viewport" data-astro-cid-jalpcphr> <div class="item" data-astro-cid-jalpcphr> <span class="title transparent" data-astro-cid-jalpcphr> About </span> <div class="icon-state-wrapper" data-active="false" data-astro-cid-272faz54><svg width="1em" height="1em" data-astro-cid-jalpcphr="true" class="icon default icon" data-astro-cid-272faz54="true" data-astro-cid-bfoveg4b="true" data-icon="solar:ghost-broken">   <symbol id="ai:solar:ghost-broken" viewBox="0 0 24 24"><g fill="none"><path fill="currentColor" d="M16 10.5c0 .828-.448 1.5-1 1.5s-1-.672-1-1.5s.448-1.5 1-1.5s1 .672 1 1.5"/><ellipse cx="9" cy="10.5" fill="currentColor" rx="1" ry="1.5"/><path stroke="currentColor" stroke-linecap="round" stroke-width="1.5" d="M22 12.3C22 6.613 17.523 2 12 2S2 6.612 2 12.3v7.423c0 1.322 1.351 2.182 2.5 1.591a2.82 2.82 0 0 1 2.896.186a2.82 2.82 0 0 0 3.208 0l.353-.242a1.84 1.84 0 0 1 2.086 0l.353.242a2.82 2.82 0 0 0 3.208 0a2.82 2.82 0 0 1 2.897-.186c1.148.591 2.499-.269 2.499-1.591v-3.711"/></g></symbol><use href="#ai:solar:ghost-broken"></use>  </svg><svg width="1em" height="1em" data-astro-cid-jalpcphr="true" class="icon hover icon" data-astro-cid-272faz54="true" data-astro-cid-bfoveg4b="true" data-icon="solar:ghost-smile-outline">   <symbol id="ai:solar:ghost-smile-outline" viewBox="0 0 24 24"><path fill="currentColor" d="M10 9.5c0 .828-.448 1.5-1 1.5s-1-.672-1-1.5S8.448 8 9 8s1 .672 1 1.5m5 1.5c.552 0 1-.672 1-1.5S15.552 8 15 8s-1 .672-1 1.5s.448 1.5 1 1.5m-5.553 3.398a.75.75 0 1 0-.894 1.204A5.77 5.77 0 0 0 12 16.75a5.77 5.77 0 0 0 3.447-1.148a.75.75 0 1 0-.894-1.204A4.27 4.27 0 0 1 12 15.25a4.27 4.27 0 0 1-2.553-.852"/><path fill="currentColor" fill-rule="evenodd" d="M12 1.25C6.042 1.25 1.25 6.219 1.25 12.3v7.423c0 1.847 1.912 3.123 3.593 2.258a2.07 2.07 0 0 1 2.129.137a3.57 3.57 0 0 0 4.056 0l.353-.242a1.085 1.085 0 0 1 1.238 0l.353.242a3.57 3.57 0 0 0 4.056 0a2.07 2.07 0 0 1 2.13-.137c1.68.865 3.592-.412 3.592-2.258v-7.422C22.75 6.219 17.958 1.25 12 1.25M2.75 12.3c0-5.295 4.162-9.55 9.25-9.55s9.25 4.255 9.25 9.55v7.423c0 .798-.79 1.242-1.406.924a3.57 3.57 0 0 0-3.665.235a2.07 2.07 0 0 1-2.358 0l-.353-.243a2.585 2.585 0 0 0-2.936 0l-.353.242a2.07 2.07 0 0 1-2.358 0a3.57 3.57 0 0 0-3.665-.234c-.617.318-1.406-.126-1.406-.924z" clip-rule="evenodd"/></symbol><use href="#ai:solar:ghost-smile-outline"></use>  </svg><svg width="1em" height="1em" data-astro-cid-jalpcphr="true" class="icon active icon" data-astro-cid-272faz54="true" data-astro-cid-bfoveg4b="true" data-icon="solar:ghost-smile-bold-duotone">   <symbol id="ai:solar:ghost-smile-bold-duotone" viewBox="0 0 24 24"><path fill="currentColor" d="M22 12v7.206a1.727 1.727 0 0 1-2.5 1.544a2.89 2.89 0 0 0-2.896.18a2.89 2.89 0 0 1-3.208 0l-.353-.234a1.88 1.88 0 0 0-2.086 0l-.353.235a2.89 2.89 0 0 1-3.208 0a2.89 2.89 0 0 0-2.897-.18A1.727 1.727 0 0 1 2 19.205V12C2 6.477 6.477 2 12 2s10 4.477 10 10" opacity=".5"/><path fill="currentColor" d="M9.447 14.398a.75.75 0 1 0-.894 1.204A5.77 5.77 0 0 0 12 16.75a5.77 5.77 0 0 0 3.447-1.148a.75.75 0 1 0-.894-1.204A4.27 4.27 0 0 1 12 15.25a4.27 4.27 0 0 1-2.553-.852M16 9.5c0 .828-.448 1.5-1 1.5s-1-.672-1-1.5s.448-1.5 1-1.5s1 .672 1 1.5M9 11c.552 0 1-.672 1-1.5S9.552 8 9 8s-1 .672-1 1.5s.448 1.5 1 1.5"/></symbol><use href="#ai:solar:ghost-smile-bold-duotone"></use>  </svg></div> </div> </a> </nav> <div class="content" data-astro-cid-jalpcphr> <ul class="side-home" data-astro-cid-fjevzmm4> <li data-astro-cid-fjevzmm4><strong class="side-home-title" data-astro-cid-fjevzmm4="true">gkzhb&#39;s blog</strong></li> <li class="side-home-sub" data-astro-cid-fjevzmm4></li> <li class="side-home-bio" data-astro-cid-fjevzmm4><p data-astro-cid-fjevzmm4>Always believe that something wonderful is about to happen.</p></li> </ul> </div> </div> </div> <div class="footer" data-astro-cid-jalpcphr> <a id="theme-toggle" href="javascript:void(0)" role="button" data-astro-cid-jalpcphr> <div class="item width-2" data-astro-cid-jalpcphr> <span class="title transparent" data-astro-cid-jalpcphr> <span class="light" data-astro-cid-jalpcphr>light</span> <span class="dark" data-astro-cid-jalpcphr>dark</span> </span> <div class="icon-wrapper" data-astro-cid-bfoveg4b><svg width="1em" height="1em" data-astro-cid-jalpcphr="true" class="icon light-only icon" data-astro-cid-bfoveg4b="true" data-icon="solar:cloud-sun-2-bold-duotone">   <symbol id="ai:solar:cloud-sun-2-bold-duotone" viewBox="0 0 24 24"><path fill="currentColor" d="M11.5 8a3.5 3.5 0 1 1-7 0a3.5 3.5 0 0 1 7 0" opacity=".5"/><path fill="currentColor" fill-rule="evenodd" d="M7.5 1.25a.75.75 0 0 1 .75.75v.5a.75.75 0 0 1-1.5 0V2a.75.75 0 0 1 .75-.75M3.08 3.08a.75.75 0 0 1 1.062 0l.216.217a.75.75 0 0 1-1.061 1.06l-.216-.216a.75.75 0 0 1 0-1.06m8.839 0a.75.75 0 0 1 0 1.061l-.216.216a.75.75 0 1 1-1.06-1.06l.215-.216a.75.75 0 0 1 1.061 0M1.25 7.5A.75.75 0 0 1 2 6.75h.5a.75.75 0 0 1 0 1.5H2a.75.75 0 0 1-.75-.75m3.108 3.143a.75.75 0 0 1 0 1.06l-.216.216a.75.75 0 0 1-1.061-1.06l.216-.216a.75.75 0 0 1 1.06 0" clip-rule="evenodd" opacity=".5"/><path fill="currentColor" d="M16.286 22C19.442 22 22 19.472 22 16.353c0-2.472-1.607-4.573-3.845-5.338C17.837 8.194 15.415 6 12.476 6C9.32 6 6.762 8.528 6.762 11.647c0 .69.125 1.35.354 1.962a4.4 4.4 0 0 0-.83-.08C3.919 13.53 2 15.426 2 17.765S3.919 22 6.286 22z"/></symbol><use href="#ai:solar:cloud-sun-2-bold-duotone"></use>  </svg><svg width="1em" height="1em" data-astro-cid-jalpcphr="true" class="icon dark-only icon" data-astro-cid-bfoveg4b="true" data-icon="solar:moon-bold-duotone">   <symbol id="ai:solar:moon-bold-duotone" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M22 12c0 5.523-4.477 10-10 10a10 10 0 0 1-3.321-.564A9 9 0 0 1 8 18a8.97 8.97 0 0 1 2.138-5.824A6.5 6.5 0 0 0 15.5 15a6.5 6.5 0 0 0 5.567-3.143c.24-.396.933-.32.933.143" clip-rule="evenodd" opacity=".5"/><path fill="currentColor" d="M2 12c0 4.359 2.789 8.066 6.679 9.435A9 9 0 0 1 8 18c0-2.221.805-4.254 2.138-5.824A6.47 6.47 0 0 1 9 8.5a6.5 6.5 0 0 1 3.143-5.567C12.54 2.693 12.463 2 12 2C6.477 2 2 6.477 2 12"/></symbol><use href="#ai:solar:moon-bold-duotone"></use>  </svg></div> </div> </a> <a href="https://github.com/gkzhb" data-astro-cid-jalpcphr> <div class="item width-2" data-astro-cid-jalpcphr> <span class="title transparent" data-astro-cid-jalpcphr> GitHub </span> <svg width="1em" height="1em" data-astro-cid-jalpcphr="true" class="icon" data-icon="simple-icons:github">   <symbol id="ai:simple-icons:github" viewBox="0 0 24 24"><path fill="currentColor" d="M12 .297c-6.63 0-12 5.373-12 12c0 5.303 3.438 9.8 8.205 11.385c.6.113.82-.258.82-.577c0-.285-.01-1.04-.015-2.04c-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729c1.205.084 1.838 1.236 1.838 1.236c1.07 1.835 2.809 1.305 3.495.998c.108-.776.417-1.305.76-1.605c-2.665-.3-5.466-1.332-5.466-5.93c0-1.31.465-2.38 1.235-3.22c-.135-.303-.54-1.523.105-3.176c0 0 1.005-.322 3.3 1.23c.96-.267 1.98-.399 3-.405c1.02.006 2.04.138 3 .405c2.28-1.552 3.285-1.23 3.285-1.23c.645 1.653.24 2.873.12 3.176c.765.84 1.23 1.91 1.23 3.22c0 4.61-2.805 5.625-5.475 5.92c.42.36.81 1.096.81 2.22c0 1.606-.015 2.896-.015 3.286c0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></symbol><use href="#ai:simple-icons:github"></use>  </svg> </div> </a> </div> </div> <script type="module" src="/_astro/BaseSide.astro_astro_type_script_index_0_lang.DOrw5quG.js"></script>   <div class="content-wrapper" data-astro-cid-4n3psh5z>    <article data-pagefind-body> <h1 data-astro-cid-xa76vfdz>使用 ngrok 实现内网穿透（自建 ngrok 服务器）</h1> <p class="inline-meta" data-astro-cid-xa76vfdz>  <span data-astro-cid-xa76vfdz>published: </span> <time datetime="2019-03-16T19:18:13.000Z" data-astro-cid-xa76vfdz> 3/16/2019 </time>    </p> <p class="inline-meta" data-pagefind-ignore data-astro-cid-xa76vfdz> <span class="category" data-astro-cid-xa76vfdz> <svg width="1em" height="1em" data-astro-cid-xa76vfdz="true" data-icon="solar:bookmark-bold-duotone">   <symbol id="ai:solar:bookmark-bold-duotone" viewBox="0 0 24 24"><path fill="currentColor" d="M21 11.098v4.993c0 3.096 0 4.645-.734 5.321c-.35.323-.792.526-1.263.58c-.987.113-2.14-.907-4.445-2.946c-1.02-.901-1.529-1.352-2.118-1.47a2.2 2.2 0 0 0-.88 0c-.59.118-1.099.569-2.118 1.47c-2.305 2.039-3.458 3.059-4.445 2.945a2.24 2.24 0 0 1-1.263-.579C3 20.736 3 19.188 3 16.091v-4.994C3 6.81 3 4.666 4.318 3.333S7.758 2 12 2s6.364 0 7.682 1.332S21 6.81 21 11.098" opacity=".5"/><path fill="currentColor" d="M9 5.25a.75.75 0 0 0 0 1.5h6a.75.75 0 0 0 0-1.5z"/></symbol><use href="#ai:solar:bookmark-bold-duotone"></use>  </svg> <a href="/categories/Programming" data-astro-cid-xa76vfdz> Programming </a> </span> <span class="tags" data-astro-cid-xa76vfdz> <svg width="1em" height="1em" data-astro-cid-xa76vfdz="true" data-icon="solar:tag-bold-duotone">   <symbol id="ai:solar:tag-bold-duotone" viewBox="0 0 24 24"><path fill="currentColor" d="M4.728 16.137c-1.545-1.546-2.318-2.318-2.605-3.321c-.288-1.003-.042-2.068.45-4.197l.283-1.228c.413-1.792.62-2.688 1.233-3.302s1.51-.82 3.302-1.233l1.228-.284c2.13-.491 3.194-.737 4.197-.45c1.003.288 1.775 1.061 3.32 2.606l1.83 1.83C20.657 9.248 22 10.592 22 12.262c0 1.671-1.344 3.015-4.033 5.704c-2.69 2.69-4.034 4.034-5.705 4.034c-1.67 0-3.015-1.344-5.704-4.033z" opacity=".5"/><path fill="currentColor" d="M10.124 7.271a2.017 2.017 0 1 1-2.853 2.852a2.017 2.017 0 0 1 2.853-2.852m8.927 4.78l-6.979 6.98a.75.75 0 1 1-1.06-1.06l6.979-6.98a.75.75 0 1 1 1.06 1.06"/></symbol><use href="#ai:solar:tag-bold-duotone"></use>  </svg> <span class="post-list-tag-item" data-astro-cid-xa76vfdz>  <a href="/tags/Network" data-astro-cid-xa76vfdz>Network</a> </span> </span> </p> <div class="admonition warning" data-pagefind-ignore data-astro-cid-xa76vfdz> <span class="title" data-astro-cid-xa76vfdz>
Timeliness Warning · Last updated
5 years ago </span> <p data-astro-cid-xa76vfdz> <strong data-astro-cid-xa76vfdz>
The information in this article may be outdated. Please verify
          carefully.
</strong> </p> </div>     <p>有时候我希望能直接通过互联网访问到层层路由下的个人电脑，但是在没有固定 IPv4 的情况下很难做到这一点。一个解决方法就是使用内网穿透技术，而我选择用 ngrok 来实现。ngrok 在 1.x 版本时是开源的，到了 2.x 版本就闭源了。因为自建 ngrok 服务器需要将自己生成的证书编译到客户端中，所以只能使用开源的 1.x 版本从源码编译生成。</p>
<!--more-->
<h2 id="前提条件">前提条件<a class="anchor" href="#前提条件"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h2>
<ul>
<li>拥有一个域名
免费域名可以在<a href="https://www.freenom.com/" data-external="" rel="nofollow noopener noreferrer" target="_blank">Freenom</a>上买到，但域名无法在国内备案。</li>
<li>拥有一个有固定 IP 的服务器
购买 VPS 一般都会提供免费固定 IP，而且国内有学生优惠的话，VPS 价格在每月 10 元左右，挺便宜。</li>
</ul>
<h2 id="生成证书并编译-ngrok-服务端和客户端">生成证书并编译 ngrok 服务端和客户端<a class="anchor" href="#生成证书并编译-ngrok-服务端和客户端"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h2>
<p>ngrok 1.x 版本在 Github 上网址是 [[<a href="https://github.com/inconshreveable/ngrok%5D%5D%EF%BC%8C%E5%AE%83%E6%98%AF%E7%94%A8" data-external="" rel="nofollow noopener noreferrer" target="_blank">https://github.com/inconshreveable/ngrok]]，它是用</a> Go 语言编写的。</p>
<p>编译 ngrok 需要使用相应的编译工具，在 Ubuntu 上可以使用命令来安装这些工具：</p>
<div class="code-block"><div class="code-header"><span class="code-title hidden"></span><span class="code-language">bash</span><button class="code-copy" data-code="$ sudo apt-get install build-essential mercurial git" onclick="navigator.clipboard.writeText(this.dataset.code ?? &#x22;Copy failed&#x22;);
                  this.classList.add(&#x22;copied&#x22;); setTimeout(() => this.classList.remove(&#x22;copied&#x22;), 1000);"> </button></div><pre class="astro-code astro-code-themes vitesse-light catppuccin-frappe" style="background-color:#ffffff;--shiki-dark-bg:#303446;color:#393a34;--shiki-dark:#c6d0f5; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#59873A;font-style:inherit;--shiki-dark:#8CAAEE;--shiki-dark-font-style:italic">$</span><span style="color:#B56959;--shiki-dark:#A6D189"> sudo</span><span style="color:#B56959;--shiki-dark:#A6D189"> apt-get</span><span style="color:#B56959;--shiki-dark:#A6D189"> install</span><span style="color:#B56959;--shiki-dark:#A6D189"> build-essential</span><span style="color:#B56959;--shiki-dark:#A6D189"> mercurial</span><span style="color:#B56959;--shiki-dark:#A6D189"> git</span></span></code></pre></div>
<p>其中，mercurial 和 git 都是版本控制软件。还有最重要的就是安装 golang ，我选择从 golang 官网下载最新版本然后手动安装。安装过程可以参考 Go 的官方文档。</p>
<p>在安装好所需的编译环境后，可以从 Github 上 clone 代码</p>
<div class="code-block"><div class="code-header"><span class="code-title hidden"></span><span class="code-language">bash</span><button class="code-copy" data-code="$ git clone https://github.com/inconshreveable/ngrok.git" onclick="navigator.clipboard.writeText(this.dataset.code ?? &#x22;Copy failed&#x22;);
                  this.classList.add(&#x22;copied&#x22;); setTimeout(() => this.classList.remove(&#x22;copied&#x22;), 1000);"> </button></div><pre class="astro-code astro-code-themes vitesse-light catppuccin-frappe" style="background-color:#ffffff;--shiki-dark-bg:#303446;color:#393a34;--shiki-dark:#c6d0f5; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#59873A;font-style:inherit;--shiki-dark:#8CAAEE;--shiki-dark-font-style:italic">$</span><span style="color:#B56959;--shiki-dark:#A6D189"> git</span><span style="color:#B56959;--shiki-dark:#A6D189"> clone</span><span style="color:#B56959;--shiki-dark:#A6D189"> https://github.com/inconshreveable/ngrok.git</span></span></code></pre></div>
<p>在编译之前，要先指定 Go 的工作路径，即编译时源文件所在文件夹的位置：<code>export GOPATH=[Working Directory]</code>，将 <code>[Working Directory]</code> 改为 ngrok 的绝对路径，如果按照上面一步 clone 的话应该是当前工作路径 + <code>/ngrok</code>。在开始编译之前，我们还需要生成我们自己的证书：</p>
<div class="code-block"><div class="code-header"><span class="code-title hidden"></span><span class="code-language">bash</span><button class="code-copy" data-code="export NGROK_DOMAIN=&#x22;[NGROK_BASE_DOMAIN]&#x22;  # 设置环境变量，ngrok 域名
openssl genrsa -out rootCA.key 2048
openssl req -x509 -new -nodes -key rootCA.key -subj &#x22;/CN=$NGROK_DOMAIN&#x22; -days 5000 -out rootCA.pem
openssl genrsa -out server.key 2048
openssl req -new -key server.key -subj &#x22;/CN=$NGROK_DOMAIN&#x22; -out server.csr
openssl x509 -req -in server.csr -CA rootCA.pem -CAkey rootCA.key -CAcreateserial -out server.crt -days 5000" onclick="navigator.clipboard.writeText(this.dataset.code ?? &#x22;Copy failed&#x22;);
                  this.classList.add(&#x22;copied&#x22;); setTimeout(() => this.classList.remove(&#x22;copied&#x22;), 1000);"> </button></div><pre class="astro-code astro-code-themes vitesse-light catppuccin-frappe" style="background-color:#ffffff;--shiki-dark-bg:#303446;color:#393a34;--shiki-dark:#c6d0f5; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#AB5959;--shiki-dark:#CA9EE6">export</span><span style="color:#B07D48;--shiki-dark:#C6D0F5"> NGROK_DOMAIN</span><span style="color:#999999;--shiki-dark:#81C8BE">=</span><span style="color:#B5695977;--shiki-dark:#A6D189">"</span><span style="color:#B56959;--shiki-dark:#A6D189">[NGROK_BASE_DOMAIN]</span><span style="color:#B5695977;--shiki-dark:#A6D189">"</span><span style="color:#A0ADA0;font-style:inherit;--shiki-dark:#737994;--shiki-dark-font-style:italic">  # 设置环境变量，ngrok 域名</span></span>
<span class="line"><span style="color:#59873A;font-style:inherit;--shiki-dark:#8CAAEE;--shiki-dark-font-style:italic">openssl</span><span style="color:#B56959;--shiki-dark:#A6D189"> genrsa</span><span style="color:#A65E2B;--shiki-dark:#A6D189"> -out</span><span style="color:#B56959;--shiki-dark:#A6D189"> rootCA.key</span><span style="color:#2F798A;--shiki-dark:#EF9F76"> 2048</span></span>
<span class="line"><span style="color:#59873A;font-style:inherit;--shiki-dark:#8CAAEE;--shiki-dark-font-style:italic">openssl</span><span style="color:#B56959;--shiki-dark:#A6D189"> req</span><span style="color:#A65E2B;--shiki-dark:#A6D189"> -x509</span><span style="color:#A65E2B;--shiki-dark:#A6D189"> -new</span><span style="color:#A65E2B;--shiki-dark:#A6D189"> -nodes</span><span style="color:#A65E2B;--shiki-dark:#A6D189"> -key</span><span style="color:#B56959;--shiki-dark:#A6D189"> rootCA.key</span><span style="color:#A65E2B;--shiki-dark:#A6D189"> -subj</span><span style="color:#B5695977;--shiki-dark:#A6D189"> "</span><span style="color:#B56959;--shiki-dark:#A6D189">/CN=</span><span style="color:#B56959;--shiki-dark:#C6D0F5">$NGROK_DOMAIN</span><span style="color:#B5695977;--shiki-dark:#A6D189">"</span><span style="color:#A65E2B;--shiki-dark:#A6D189"> -days</span><span style="color:#2F798A;--shiki-dark:#EF9F76"> 5000</span><span style="color:#A65E2B;--shiki-dark:#A6D189"> -out</span><span style="color:#B56959;--shiki-dark:#A6D189"> rootCA.pem</span></span>
<span class="line"><span style="color:#59873A;font-style:inherit;--shiki-dark:#8CAAEE;--shiki-dark-font-style:italic">openssl</span><span style="color:#B56959;--shiki-dark:#A6D189"> genrsa</span><span style="color:#A65E2B;--shiki-dark:#A6D189"> -out</span><span style="color:#B56959;--shiki-dark:#A6D189"> server.key</span><span style="color:#2F798A;--shiki-dark:#EF9F76"> 2048</span></span>
<span class="line"><span style="color:#59873A;font-style:inherit;--shiki-dark:#8CAAEE;--shiki-dark-font-style:italic">openssl</span><span style="color:#B56959;--shiki-dark:#A6D189"> req</span><span style="color:#A65E2B;--shiki-dark:#A6D189"> -new</span><span style="color:#A65E2B;--shiki-dark:#A6D189"> -key</span><span style="color:#B56959;--shiki-dark:#A6D189"> server.key</span><span style="color:#A65E2B;--shiki-dark:#A6D189"> -subj</span><span style="color:#B5695977;--shiki-dark:#A6D189"> "</span><span style="color:#B56959;--shiki-dark:#A6D189">/CN=</span><span style="color:#B56959;--shiki-dark:#C6D0F5">$NGROK_DOMAIN</span><span style="color:#B5695977;--shiki-dark:#A6D189">"</span><span style="color:#A65E2B;--shiki-dark:#A6D189"> -out</span><span style="color:#B56959;--shiki-dark:#A6D189"> server.csr</span></span>
<span class="line"><span style="color:#59873A;font-style:inherit;--shiki-dark:#8CAAEE;--shiki-dark-font-style:italic">openssl</span><span style="color:#B56959;--shiki-dark:#A6D189"> x509</span><span style="color:#A65E2B;--shiki-dark:#A6D189"> -req</span><span style="color:#A65E2B;--shiki-dark:#A6D189"> -in</span><span style="color:#B56959;--shiki-dark:#A6D189"> server.csr</span><span style="color:#A65E2B;--shiki-dark:#A6D189"> -CA</span><span style="color:#B56959;--shiki-dark:#A6D189"> rootCA.pem</span><span style="color:#A65E2B;--shiki-dark:#A6D189"> -CAkey</span><span style="color:#B56959;--shiki-dark:#A6D189"> rootCA.key</span><span style="color:#A65E2B;--shiki-dark:#A6D189"> -CAcreateserial</span><span style="color:#A65E2B;--shiki-dark:#A6D189"> -out</span><span style="color:#B56959;--shiki-dark:#A6D189"> server.crt</span><span style="color:#A65E2B;--shiki-dark:#A6D189"> -days</span><span style="color:#2F798A;--shiki-dark:#EF9F76"> 5000</span></span></code></pre></div>
<p>其中，需要将 <code>[NGROK_BASE_DOMAIN]</code> 替换为你自己将要使用的 ngrok 域名。比如 <code>ngrok.YourDomain.com</code> 或 <code>tunnel.YourDomain.com</code>。我们需要将域名通过 A 记录指向那个拥有固定 IP 的服务器的 IP。在域名 DNS 记录管理中，添加两条 A 记录：主机记录(Host Name)为 <code>*.tunnel</code> 或 <code>*.ngrok</code> 即你将要使用的 ngrok 子域名，另一条主机记录为 <code>tunnel</code> 或 <code>ngrok</code> 就是将前面的 <code>*.</code> 去掉，第二条主机记录应该可以不加。这两条记录类型(Record Type)都为 A 类型，IP 地址指向服务器的固定 IP 。
不过我在 Freenom 上无法添加 <code>*.ngrok</code> 主机记录，估计是 DNS 服务商不支持通配符 <code>*</code>，所以我只能根据自己的需要手动添加多条 <code>[service].ngrok</code> 记录，<code>[service]</code> 更改为需要使用的二级域名。
在执行完上面的 openssl 命令后，会生成六个文件，将其中几个文件移动到 ngrok 仓库的指定位置：</p>
<div class="code-block"><div class="code-header"><span class="code-title hidden"></span><span class="code-language">bash</span><button class="code-copy" data-code="cp rootCA.pem $GOPATH/assets/client/tls/ngrokroot.crt  # 复制rootCA.pem到assets/client/tls/并更名为ngrokroot.crt
cp server.crt $GOPATH/assets/server/tls/snakeoil.crt # 复制server.crt到assets/server/tls/并更名为snakeoil.crt
cp server.key $GOPATH/assets/server/tls/snakeoil.key # 复制server.key到assets/server/tls/并更名为snakeoil.key" onclick="navigator.clipboard.writeText(this.dataset.code ?? &#x22;Copy failed&#x22;);
                  this.classList.add(&#x22;copied&#x22;); setTimeout(() => this.classList.remove(&#x22;copied&#x22;), 1000);"> </button></div><pre class="astro-code astro-code-themes vitesse-light catppuccin-frappe" style="background-color:#ffffff;--shiki-dark-bg:#303446;color:#393a34;--shiki-dark:#c6d0f5; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#59873A;font-style:inherit;--shiki-dark:#8CAAEE;--shiki-dark-font-style:italic">cp</span><span style="color:#B56959;--shiki-dark:#A6D189"> rootCA.pem</span><span style="color:#B07D48;--shiki-dark:#C6D0F5"> $GOPATH</span><span style="color:#B56959;--shiki-dark:#A6D189">/assets/client/tls/ngrokroot.crt</span><span style="color:#A0ADA0;font-style:inherit;--shiki-dark:#737994;--shiki-dark-font-style:italic">  # 复制rootCA.pem到assets/client/tls/并更名为ngrokroot.crt</span></span>
<span class="line"><span style="color:#59873A;font-style:inherit;--shiki-dark:#8CAAEE;--shiki-dark-font-style:italic">cp</span><span style="color:#B56959;--shiki-dark:#A6D189"> server.crt</span><span style="color:#B07D48;--shiki-dark:#C6D0F5"> $GOPATH</span><span style="color:#B56959;--shiki-dark:#A6D189">/assets/server/tls/snakeoil.crt</span><span style="color:#A0ADA0;font-style:inherit;--shiki-dark:#737994;--shiki-dark-font-style:italic"> # 复制server.crt到assets/server/tls/并更名为snakeoil.crt</span></span>
<span class="line"><span style="color:#59873A;font-style:inherit;--shiki-dark:#8CAAEE;--shiki-dark-font-style:italic">cp</span><span style="color:#B56959;--shiki-dark:#A6D189"> server.key</span><span style="color:#B07D48;--shiki-dark:#C6D0F5"> $GOPATH</span><span style="color:#B56959;--shiki-dark:#A6D189">/assets/server/tls/snakeoil.key</span><span style="color:#A0ADA0;font-style:inherit;--shiki-dark:#737994;--shiki-dark-font-style:italic"> # 复制server.key到assets/server/tls/并更名为snakeoil.key</span></span></code></pre></div>
<p>之后，我们就可以开始编译 ngrok 了:</p>
<div class="code-block"><div class="code-header"><span class="code-title hidden"></span><span class="code-language">bash</span><button class="code-copy" data-code="GOOS=[OS] GOARCH=[CPU ARCH] make release-server # 编译服务端
GOOS=[OS] GOARCH=[CPU ARCH] make release-client # 编译客户端" onclick="navigator.clipboard.writeText(this.dataset.code ?? &#x22;Copy failed&#x22;);
                  this.classList.add(&#x22;copied&#x22;); setTimeout(() => this.classList.remove(&#x22;copied&#x22;), 1000);"> </button></div><pre class="astro-code astro-code-themes vitesse-light catppuccin-frappe" style="background-color:#ffffff;--shiki-dark-bg:#303446;color:#393a34;--shiki-dark:#c6d0f5; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#B07D48;--shiki-dark:#C6D0F5">GOOS</span><span style="color:#999999;--shiki-dark:#81C8BE">=</span><span style="color:#B56959;--shiki-dark:#A6D189">[OS</span><span style="color:rgba(255, 18, 18, 0.8);--shiki-dark:#ea999c">]</span><span style="color:rgba(255, 18, 18, 0.8);--shiki-dark:#ea999c"> </span><span style="color:#B07D48;--shiki-dark:#C6D0F5">GOARCH</span><span style="color:#999999;--shiki-dark:#81C8BE">=</span><span style="color:#B56959;--shiki-dark:#A6D189">[CPU</span><span style="color:rgba(255, 18, 18, 0.8);font-style:inherit;--shiki-dark:#ea999c;--shiki-dark-font-style:italic"> ARCH</span><span style="color:rgba(255, 18, 18, 0.8);font-style:inherit;--shiki-dark:#ea999c;--shiki-dark-font-style:italic">]</span><span style="color:#B56959;--shiki-dark:#A6D189"> make</span><span style="color:#B56959;--shiki-dark:#A6D189"> release-server</span><span style="color:#A0ADA0;font-style:inherit;--shiki-dark:#737994;--shiki-dark-font-style:italic"> # 编译服务端</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#C6D0F5">GOOS</span><span style="color:#999999;--shiki-dark:#81C8BE">=</span><span style="color:#B56959;--shiki-dark:#A6D189">[OS</span><span style="color:rgba(255, 18, 18, 0.8);--shiki-dark:#ea999c">]</span><span style="color:rgba(255, 18, 18, 0.8);--shiki-dark:#ea999c"> </span><span style="color:#B07D48;--shiki-dark:#C6D0F5">GOARCH</span><span style="color:#999999;--shiki-dark:#81C8BE">=</span><span style="color:#B56959;--shiki-dark:#A6D189">[CPU</span><span style="color:rgba(255, 18, 18, 0.8);font-style:inherit;--shiki-dark:#ea999c;--shiki-dark-font-style:italic"> ARCH</span><span style="color:rgba(255, 18, 18, 0.8);font-style:inherit;--shiki-dark:#ea999c;--shiki-dark-font-style:italic">]</span><span style="color:#B56959;--shiki-dark:#A6D189"> make</span><span style="color:#B56959;--shiki-dark:#A6D189"> release-client</span><span style="color:#A0ADA0;font-style:inherit;--shiki-dark:#737994;--shiki-dark-font-style:italic"> # 编译客户端</span></span></code></pre></div>
<p>将 <code>[OS]</code> 换成对应的操作系统 <code>linux</code> <code>windows</code> <code>android</code>，<code>[CPU ARCH]</code> 换成对应的 CPU 架构 <code>386</code>(32位 x86) <code>amd64</code>(64位 x86-64)。具体组合见 <a href="https://stackoverflow.com/questions/20728767/all-possible-goos-value/20728862" data-external="" rel="nofollow noopener noreferrer" target="_blank">StackOverflow</a>：</p>
<div class="code-block"><div class="code-header"><span class="code-title hidden"></span><span class="code-language">plaintext</span><button class="code-copy" data-code="$GOOS $GOARCH
android   arm
darwin    386
darwin    amd64
darwin    arm
darwin    arm64
dragonfly amd64
freebsd   386
freebsd   amd64
freebsd   arm
linux     386
linux     amd64
linux     arm
linux     arm64
linux     ppc64
linux     ppc64le
linux     mips
linux     mipsle
linux     mips64
linux     mips64le
netbsd    386
netbsd    amd64
netbsd    arm
openbsd   386
openbsd   amd64
openbsd   arm
plan9     386
plan9     amd64
solaris   amd64
windows   386
windows   amd64" onclick="navigator.clipboard.writeText(this.dataset.code ?? &#x22;Copy failed&#x22;);
                  this.classList.add(&#x22;copied&#x22;); setTimeout(() => this.classList.remove(&#x22;copied&#x22;), 1000);"> </button></div><pre class="astro-code astro-code-themes vitesse-light catppuccin-frappe" style="background-color:#ffffff;--shiki-dark-bg:#303446;color:#393a34;--shiki-dark:#c6d0f5; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>$GOOS $GOARCH</span></span>
<span class="line"><span>android   arm</span></span>
<span class="line"><span>darwin    386</span></span>
<span class="line"><span>darwin    amd64</span></span>
<span class="line"><span>darwin    arm</span></span>
<span class="line"><span>darwin    arm64</span></span>
<span class="line"><span>dragonfly amd64</span></span>
<span class="line"><span>freebsd   386</span></span>
<span class="line"><span>freebsd   amd64</span></span>
<span class="line"><span>freebsd   arm</span></span>
<span class="line"><span>linux     386</span></span>
<span class="line"><span>linux     amd64</span></span>
<span class="line"><span>linux     arm</span></span>
<span class="line"><span>linux     arm64</span></span>
<span class="line"><span>linux     ppc64</span></span>
<span class="line"><span>linux     ppc64le</span></span>
<span class="line"><span>linux     mips</span></span>
<span class="line"><span>linux     mipsle</span></span>
<span class="line"><span>linux     mips64</span></span>
<span class="line"><span>linux     mips64le</span></span>
<span class="line"><span>netbsd    386</span></span>
<span class="line"><span>netbsd    amd64</span></span>
<span class="line"><span>netbsd    arm</span></span>
<span class="line"><span>openbsd   386</span></span>
<span class="line"><span>openbsd   amd64</span></span>
<span class="line"><span>openbsd   arm</span></span>
<span class="line"><span>plan9     386</span></span>
<span class="line"><span>plan9     amd64</span></span>
<span class="line"><span>solaris   amd64</span></span>
<span class="line"><span>windows   386</span></span>
<span class="line"><span>windows   amd64</span></span></code></pre></div>
<p>常用 <code>windows</code> + <code>amd64</code> 或者 <code>linux</code> + <code>amd64</code> 组合。<br>
编译完成后在 <code>$GOPATH/bin</code> 下可以看到 <code>ngrok</code> <code>ngrokd</code> 两个文件，如果编译 windows 平台的会有 <code>.exe</code> 后缀。服务端文件是 <code>ngrokd</code>，客户端文件为 <code>ngrok</code>。</p>
<h2 id="配置并运行服务端与客户端">配置并运行服务端与客户端<a class="anchor" href="#配置并运行服务端与客户端"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h2>
<h3 id="服务端">服务端<a class="anchor" href="#服务端"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3>
<p>服务器上可以将 <code>ngrokd</code> 与之前生成的证书 <code>server.crt</code> <code>server.key</code> 放在同一个目录中，并在目录中创建一个脚本文件 <code>run.sh</code> 来启动 ngrokd：</p>
<div class="code-block"><div class="code-header"><span class="code-title hidden"></span><span class="code-language">bash</span><button class="code-copy" data-code="#!/bin/bash
./ngrokd -tlsKey=server.key -tlsCrt=server.crt -domain=&#x22;[NGROK_BASE_DOMAIN]&#x22; -httpAddr=&#x22;:[PORT]&#x22; -httpsAddr=&#x22;:[PORT]&#x22;" onclick="navigator.clipboard.writeText(this.dataset.code ?? &#x22;Copy failed&#x22;);
                  this.classList.add(&#x22;copied&#x22;); setTimeout(() => this.classList.remove(&#x22;copied&#x22;), 1000);"> </button></div><pre class="astro-code astro-code-themes vitesse-light catppuccin-frappe" style="background-color:#ffffff;--shiki-dark-bg:#303446;color:#393a34;--shiki-dark:#c6d0f5; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#A0ADA0;font-style:inherit;--shiki-dark:#F4B8E4;--shiki-dark-font-style:italic">#!/bin/bash</span></span>
<span class="line"><span style="color:#59873A;font-style:inherit;--shiki-dark:#8CAAEE;--shiki-dark-font-style:italic">./ngrokd</span><span style="color:#A65E2B;--shiki-dark:#A6D189"> -tlsKey=server.key</span><span style="color:#A65E2B;--shiki-dark:#A6D189"> -tlsCrt=server.crt</span><span style="color:#A65E2B;--shiki-dark:#A6D189"> -domain=</span><span style="color:#B5695977;--shiki-dark:#A6D189">"</span><span style="color:#B56959;--shiki-dark:#A6D189">[NGROK_BASE_DOMAIN]</span><span style="color:#B5695977;--shiki-dark:#A6D189">"</span><span style="color:#A65E2B;--shiki-dark:#A6D189"> -httpAddr=</span><span style="color:#B5695977;--shiki-dark:#A6D189">"</span><span style="color:#B56959;--shiki-dark:#A6D189">:[PORT]</span><span style="color:#B5695977;--shiki-dark:#A6D189">"</span><span style="color:#A65E2B;--shiki-dark:#A6D189"> -httpsAddr=</span><span style="color:#B5695977;--shiki-dark:#A6D189">"</span><span style="color:#B56959;--shiki-dark:#A6D189">:[PORT]</span><span style="color:#B5695977;--shiki-dark:#A6D189">"</span></span></code></pre></div>
<p>将中括号部份换成实际需要的值。后两个 <code>[PORT]</code> 指定 ngrok 在服务器上 http 和 https 协议使用的端口。<br>
服务端运行起来之后，可以通过浏览器访问之前设置 DNS 记录的子域名，注意如果端口不是默认的，需要在域名后添加 <code>:[PORT]</code>。如果网页显示类似 <code>Tunnel ngrok.YourDomain.com:[PORT] not found</code> 字样则说明服务器成功启动。</p>
<h3 id="客户端">客户端<a class="anchor" href="#客户端"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3>
<h4 id="安装配置和运行">安装、配置和运行<a class="anchor" href="#安装配置和运行"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h4>
<p>客户端方面，注意要使用之前编译生成的 ngrok，似乎也可以使用 <a href="https://github.com/hauntek/python-ngrok" data-external="" rel="nofollow noopener noreferrer" target="_blank">python-ngork</a> 但我没有成功。客户端方面，需要新建配置文件 <code>ngrok.cfg</code>（使用 yaml 语法格式），内容如下：</p>
<div class="code-block"><div class="code-header"><span class="code-title hidden"></span><span class="code-language">yaml</span><button class="code-copy" data-code="server_addr: [NGROK_BASE_DOMAIN]:4443
trust_host_root_certs: false" onclick="navigator.clipboard.writeText(this.dataset.code ?? &#x22;Copy failed&#x22;);
                  this.classList.add(&#x22;copied&#x22;); setTimeout(() => this.classList.remove(&#x22;copied&#x22;), 1000);"> </button></div><pre class="astro-code astro-code-themes vitesse-light catppuccin-frappe" style="background-color:#ffffff;--shiki-dark-bg:#303446;color:#393a34;--shiki-dark:#c6d0f5; overflow-x: auto;" tabindex="0" data-language="yaml"><code><span class="line"><span style="color:#998418;--shiki-dark:#8CAAEE">server_addr</span><span style="color:#999999;--shiki-dark:#81C8BE">:</span><span style="color:#2993a3;--shiki-dark:#e78284"> </span><span style="color:#2993a3;--shiki-dark:#e78284">[</span><span style="color:#B56959;--shiki-dark:#A6D189">NGROK_BASE_DOMAIN</span><span style="color:#2993a3;--shiki-dark:#e78284">]</span><span style="color:#B56959;--shiki-dark:#A6D189">:4443</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#8CAAEE">trust_host_root_certs</span><span style="color:#999999;--shiki-dark:#81C8BE">:</span><span style="color:#1E754F;--shiki-dark:#EF9F76"> false</span></span></code></pre></div>
<p>这里 4443 是 ngrokd 默认的监听端口。<br>
之后通过命令运行（同样可以将这条命令写成脚本）：<code>./ngrok -subdomain [SUBDOMAIN] -config=[YOUR_CONFIG_FILE_NAME] [PORT]</code> 这是将客户端本地 80 端口代理到服务器对应的 httpAddr 端口。<br>
同样可以代理 TCP 的端口：<code>./ngrok -subdomain mydatabaseserver -config=[YOUR_CONFIG_FILE_NAME] -proto tcp 3306</code> 将 mysql 的 3306 端口代理到服务器上，这样就可以通过域名 + 端口访问到客户端对应的端口上的服务。</p>
<p>不过这样设置并不方便，写入配置文件 <code>ngrok.cfg</code> 然后选择需要的代理更加便捷：</p>
<div class="code-block"><div class="code-header"><span class="code-title hidden"></span><span class="code-language">yaml</span><button class="code-copy" data-code="server_addr: ngrok.YourDomain.com:4443
trust_host_root_certs: false
tunnels:
  http:
    subdomain: &#x22;http&#x22;
    proto:
      http: &#x22;4000&#x22;
  ssh:
    subdomain: &#x22;zhb&#x22;
    remote_port: 4422
    proto:
      tcp: &#x22;22&#x22;" onclick="navigator.clipboard.writeText(this.dataset.code ?? &#x22;Copy failed&#x22;);
                  this.classList.add(&#x22;copied&#x22;); setTimeout(() => this.classList.remove(&#x22;copied&#x22;), 1000);"> </button></div><pre class="astro-code astro-code-themes vitesse-light catppuccin-frappe" style="background-color:#ffffff;--shiki-dark-bg:#303446;color:#393a34;--shiki-dark:#c6d0f5; overflow-x: auto;" tabindex="0" data-language="yaml"><code><span class="line"><span style="color:#998418;--shiki-dark:#8CAAEE">server_addr</span><span style="color:#999999;--shiki-dark:#81C8BE">:</span><span style="color:#B56959;--shiki-dark:#A6D189"> ngrok.YourDomain.com:4443</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#8CAAEE">trust_host_root_certs</span><span style="color:#999999;--shiki-dark:#81C8BE">:</span><span style="color:#1E754F;--shiki-dark:#EF9F76"> false</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#8CAAEE">tunnels</span><span style="color:#999999;--shiki-dark:#81C8BE">:</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#8CAAEE">  http</span><span style="color:#999999;--shiki-dark:#81C8BE">:</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#8CAAEE">    subdomain</span><span style="color:#999999;--shiki-dark:#81C8BE">:</span><span style="color:#B5695977;--shiki-dark:#A6D189"> "</span><span style="color:#B56959;--shiki-dark:#A6D189">http</span><span style="color:#B5695977;--shiki-dark:#A6D189">"</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#8CAAEE">    proto</span><span style="color:#999999;--shiki-dark:#81C8BE">:</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#8CAAEE">      http</span><span style="color:#999999;--shiki-dark:#81C8BE">:</span><span style="color:#B5695977;--shiki-dark:#A6D189"> "</span><span style="color:#B56959;--shiki-dark:#A6D189">4000</span><span style="color:#B5695977;--shiki-dark:#A6D189">"</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#8CAAEE">  ssh</span><span style="color:#999999;--shiki-dark:#81C8BE">:</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#8CAAEE">    subdomain</span><span style="color:#999999;--shiki-dark:#81C8BE">:</span><span style="color:#B5695977;--shiki-dark:#A6D189"> "</span><span style="color:#B56959;--shiki-dark:#A6D189">zhb</span><span style="color:#B5695977;--shiki-dark:#A6D189">"</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#8CAAEE">    remote_port</span><span style="color:#999999;--shiki-dark:#81C8BE">:</span><span style="color:#2F798A;--shiki-dark:#EF9F76"> 4422</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#8CAAEE">    proto</span><span style="color:#999999;--shiki-dark:#81C8BE">:</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#8CAAEE">      tcp</span><span style="color:#999999;--shiki-dark:#81C8BE">:</span><span style="color:#B5695977;--shiki-dark:#A6D189"> "</span><span style="color:#B56959;--shiki-dark:#A6D189">22</span><span style="color:#B5695977;--shiki-dark:#A6D189">"</span></span></code></pre></div>
<p><code>remote_port</code> 表示指定 TCP 在服务器上监听的端口。注意不要使用 Tab 而应该用空格进行缩进。
最后通过命令 <code>./ngrok -config=ngrok.cfg start ssh</code> 启动 tunnels 中的 ssh 代理。start 后可以接多个代理名称，中间用空格分格。<br>
更多客户端配置文件选项可以访问 ngork 官网的文档进行了解（2.x 的配置文件应该是兼容的吧）。</p>
<h4 id="使用-systemctl-添加-ngrok-服务">使用 systemctl 添加 ngrok 服务<a class="anchor" href="#使用-systemctl-添加-ngrok-服务"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h4>
<h5 id="systemctl-使用命令">systemctl 使用命令<a class="anchor" href="#systemctl-使用命令"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h5>
<p>以下的 <code>[Service Name].service</code> 中的 <code>.service</code> 可以省略，即使用 <code>[Service Name]</code> 即可。</p>
<div class="code-block"><div class="code-header"><span class="code-title hidden"></span><span class="code-language">bash</span><button class="code-copy" data-code="$ systemctl start [Service Name].service # 启动 [Service Name] 服务
$ systemctl stop [Service Name].service # 停止 [Service Name] 服务
$ systemctl restart [Service Name].service # 重启 [Service Name] 服务
$ systemctl status [Service Name].service # 查看 [Service Name] 服务运行状态
$ systemctl enable [Service Name].service # 设置 [Service Name] 服务开机自启动
$ systemctl disable [Service Name].service # 关闭 [Service Name] 服务开机自启动
$ systemctl daemon-reload # 重新载入 systemd,扫描新的或有变动的单元" onclick="navigator.clipboard.writeText(this.dataset.code ?? &#x22;Copy failed&#x22;);
                  this.classList.add(&#x22;copied&#x22;); setTimeout(() => this.classList.remove(&#x22;copied&#x22;), 1000);"> </button></div><pre class="astro-code astro-code-themes vitesse-light catppuccin-frappe" style="background-color:#ffffff;--shiki-dark-bg:#303446;color:#393a34;--shiki-dark:#c6d0f5; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#59873A;font-style:inherit;--shiki-dark:#8CAAEE;--shiki-dark-font-style:italic">$</span><span style="color:#B56959;--shiki-dark:#A6D189"> systemctl</span><span style="color:#B56959;--shiki-dark:#A6D189"> start</span><span style="color:rgba(255, 18, 18, 0.8);--shiki-dark:#ea999c"> </span><span style="color:rgba(255, 18, 18, 0.8);--shiki-dark:#ea999c">[</span><span style="color:rgba(255, 18, 18, 0.8);--shiki-dark:#ea999c">Service </span><span style="color:#B56959;--shiki-dark:#A6D189">Name].service</span><span style="color:#A0ADA0;font-style:inherit;--shiki-dark:#737994;--shiki-dark-font-style:italic"> # 启动 [Service Name] 服务</span></span>
<span class="line"><span style="color:#59873A;font-style:inherit;--shiki-dark:#8CAAEE;--shiki-dark-font-style:italic">$</span><span style="color:#B56959;--shiki-dark:#A6D189"> systemctl</span><span style="color:#B56959;--shiki-dark:#A6D189"> stop</span><span style="color:rgba(255, 18, 18, 0.8);--shiki-dark:#ea999c"> </span><span style="color:rgba(255, 18, 18, 0.8);--shiki-dark:#ea999c">[</span><span style="color:rgba(255, 18, 18, 0.8);--shiki-dark:#ea999c">Service </span><span style="color:#B56959;--shiki-dark:#A6D189">Name].service</span><span style="color:#A0ADA0;font-style:inherit;--shiki-dark:#737994;--shiki-dark-font-style:italic"> # 停止 [Service Name] 服务</span></span>
<span class="line"><span style="color:#59873A;font-style:inherit;--shiki-dark:#8CAAEE;--shiki-dark-font-style:italic">$</span><span style="color:#B56959;--shiki-dark:#A6D189"> systemctl</span><span style="color:#B56959;--shiki-dark:#A6D189"> restart</span><span style="color:rgba(255, 18, 18, 0.8);--shiki-dark:#ea999c"> </span><span style="color:rgba(255, 18, 18, 0.8);--shiki-dark:#ea999c">[</span><span style="color:rgba(255, 18, 18, 0.8);--shiki-dark:#ea999c">Service </span><span style="color:#B56959;--shiki-dark:#A6D189">Name].service</span><span style="color:#A0ADA0;font-style:inherit;--shiki-dark:#737994;--shiki-dark-font-style:italic"> # 重启 [Service Name] 服务</span></span>
<span class="line"><span style="color:#59873A;font-style:inherit;--shiki-dark:#8CAAEE;--shiki-dark-font-style:italic">$</span><span style="color:#B56959;--shiki-dark:#A6D189"> systemctl</span><span style="color:#B56959;--shiki-dark:#A6D189"> status</span><span style="color:rgba(255, 18, 18, 0.8);--shiki-dark:#ea999c"> </span><span style="color:rgba(255, 18, 18, 0.8);--shiki-dark:#ea999c">[</span><span style="color:rgba(255, 18, 18, 0.8);--shiki-dark:#ea999c">Service </span><span style="color:#B56959;--shiki-dark:#A6D189">Name].service</span><span style="color:#A0ADA0;font-style:inherit;--shiki-dark:#737994;--shiki-dark-font-style:italic"> # 查看 [Service Name] 服务运行状态</span></span>
<span class="line"><span style="color:#59873A;font-style:inherit;--shiki-dark:#8CAAEE;--shiki-dark-font-style:italic">$</span><span style="color:#B56959;--shiki-dark:#A6D189"> systemctl</span><span style="color:#B56959;--shiki-dark:#A6D189"> enable</span><span style="color:rgba(255, 18, 18, 0.8);--shiki-dark:#ea999c"> </span><span style="color:rgba(255, 18, 18, 0.8);--shiki-dark:#ea999c">[</span><span style="color:rgba(255, 18, 18, 0.8);--shiki-dark:#ea999c">Service </span><span style="color:#B56959;--shiki-dark:#A6D189">Name].service</span><span style="color:#A0ADA0;font-style:inherit;--shiki-dark:#737994;--shiki-dark-font-style:italic"> # 设置 [Service Name] 服务开机自启动</span></span>
<span class="line"><span style="color:#59873A;font-style:inherit;--shiki-dark:#8CAAEE;--shiki-dark-font-style:italic">$</span><span style="color:#B56959;--shiki-dark:#A6D189"> systemctl</span><span style="color:#B56959;--shiki-dark:#A6D189"> disable</span><span style="color:rgba(255, 18, 18, 0.8);--shiki-dark:#ea999c"> </span><span style="color:rgba(255, 18, 18, 0.8);--shiki-dark:#ea999c">[</span><span style="color:rgba(255, 18, 18, 0.8);--shiki-dark:#ea999c">Service </span><span style="color:#B56959;--shiki-dark:#A6D189">Name].service</span><span style="color:#A0ADA0;font-style:inherit;--shiki-dark:#737994;--shiki-dark-font-style:italic"> # 关闭 [Service Name] 服务开机自启动</span></span>
<span class="line"><span style="color:#59873A;font-style:inherit;--shiki-dark:#8CAAEE;--shiki-dark-font-style:italic">$</span><span style="color:#B56959;--shiki-dark:#A6D189"> systemctl</span><span style="color:#B56959;--shiki-dark:#A6D189"> daemon-reload</span><span style="color:#A0ADA0;font-style:inherit;--shiki-dark:#737994;--shiki-dark-font-style:italic"> # 重新载入 systemd,扫描新的或有变动的单元</span></span></code></pre></div>
<p>下面我们将新建一个自定义的 ngrok 服务。</p>
<h5 id="添加自定义-systemctl-服务">添加自定义 systemctl 服务<a class="anchor" href="#添加自定义-systemctl-服务"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h5>
<p>新建配置文件 <code>ngrok.service</code>，内容如下：</p>
<div class="code-block"><div class="code-header"><span class="code-title hidden"></span><span class="code-language">plaintext</span><button class="code-copy" data-code="[Unit]
Description=Share local port(s) with ngrok
After=syslog.target network.target

[Service]
PrivateTmp=true
Type=simple
Restart=always
RestartSec=1min
StandardOutput=null
StandardError=null
ExecStart=/usr/local/ngrok/ngrok -config=/usr/local/ngrok/ngrok.cfg start ssh
#ExecStop=/usr/bin/killall ngrok

[Install]
WantedBy=multi-user.target" onclick="navigator.clipboard.writeText(this.dataset.code ?? &#x22;Copy failed&#x22;);
                  this.classList.add(&#x22;copied&#x22;); setTimeout(() => this.classList.remove(&#x22;copied&#x22;), 1000);"> </button></div><pre class="astro-code astro-code-themes vitesse-light catppuccin-frappe" style="background-color:#ffffff;--shiki-dark-bg:#303446;color:#393a34;--shiki-dark:#c6d0f5; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>[Unit]</span></span>
<span class="line"><span>Description=Share local port(s) with ngrok</span></span>
<span class="line"><span>After=syslog.target network.target</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[Service]</span></span>
<span class="line"><span>PrivateTmp=true</span></span>
<span class="line"><span>Type=simple</span></span>
<span class="line"><span>Restart=always</span></span>
<span class="line"><span>RestartSec=1min</span></span>
<span class="line"><span>StandardOutput=null</span></span>
<span class="line"><span>StandardError=null</span></span>
<span class="line"><span>ExecStart=/usr/local/ngrok/ngrok -config=/usr/local/ngrok/ngrok.cfg start ssh</span></span>
<span class="line"><span>#ExecStop=/usr/bin/killall ngrok</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[Install]</span></span>
<span class="line"><span>WantedBy=multi-user.target</span></span></code></pre></div>
<p>注意要修改你的 <code>ExecStart</code> 项的值，这项的值与上面的运行命令类似，不过注意 ngrok 客户端和配置文件要使用绝对路径。<code>ExecStop</code> 这项我将它注释掉了，这个命令可能误杀进程，所以不建议使用它。systemctl 有默认的 <code>ExecStop</code> 命令，具体可以参考<a href="https://stackoverflow.com/questions/40411338/how-stop-systemd-service" data-external="" rel="nofollow noopener noreferrer" target="_blank">linux - how stop systemd service - Stack Overflow</a> 中 Umut 的回答。<br>
将文件 <code>ngrok.service</code> 复制到路径 <code>/usr/lib/systemd/system/</code> 下（需要 root 权限）。然后执行命令使其开机启动与生效：</p>
<div class="code-block"><div class="code-header"><span class="code-title hidden"></span><span class="code-language">bash</span><button class="code-copy" data-code="$ systemctl enable ngrok.service
$ systemctl daemon-reload" onclick="navigator.clipboard.writeText(this.dataset.code ?? &#x22;Copy failed&#x22;);
                  this.classList.add(&#x22;copied&#x22;); setTimeout(() => this.classList.remove(&#x22;copied&#x22;), 1000);"> </button></div><pre class="astro-code astro-code-themes vitesse-light catppuccin-frappe" style="background-color:#ffffff;--shiki-dark-bg:#303446;color:#393a34;--shiki-dark:#c6d0f5; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#59873A;font-style:inherit;--shiki-dark:#8CAAEE;--shiki-dark-font-style:italic">$</span><span style="color:#B56959;--shiki-dark:#A6D189"> systemctl</span><span style="color:#B56959;--shiki-dark:#A6D189"> enable</span><span style="color:#B56959;--shiki-dark:#A6D189"> ngrok.service</span></span>
<span class="line"><span style="color:#59873A;font-style:inherit;--shiki-dark:#8CAAEE;--shiki-dark-font-style:italic">$</span><span style="color:#B56959;--shiki-dark:#A6D189"> systemctl</span><span style="color:#B56959;--shiki-dark:#A6D189"> daemon-reload</span></span></code></pre></div>
<p>最后，可以通过命令 <code>systemctl start ngrok.service</code> 启动 ngrok 服务，使用命令 <code>systemctl stop ngrok.service</code> 停止 ngrok 服务，使用 <code>systemctl status ngrok.service</code> 查看 ngrok 服务的运行状态。</p>
<h2 id="参考">参考<a class="anchor" href="#参考"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h2>
<ul>
<li><a href="https://www.svenbit.com/2014/09/run-ngrok-on-your-own-server/" data-external="" rel="nofollow noopener noreferrer" target="_blank">Run Ngrok on Your Own Server - svenbit</a></li>
<li><a href="https://blog.csdn.net/zhangguo5/article/details/77848658" data-external="" rel="nofollow noopener noreferrer" target="_blank">一分钟实现内网穿透（ngrok服务器搭建） - 学习笔记 - CSDN博客</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/29019562" data-external="" rel="nofollow noopener noreferrer" target="_blank">Ngrok完美实现内网穿透 - 知乎</a></li>
<li><a href="https://cangshui.net/?p=1943" data-external="" rel="nofollow noopener noreferrer" target="_blank">安卓端搭建网站+自建内网穿透ngrok – 沧水的博客</a></li>
<li>systemctl 配置
<ul>
<li><a href="https://blog.csdn.net/qazx123q/article/details/81212858" data-external="" rel="nofollow noopener noreferrer" target="_blank">Centos 7 ngrok 加入系统服务，支持开启和关闭服务 - opfan的博客 - CSDN博客</a></li>
<li><a href="https://www.jianshu.com/p/79059b06a121" data-external="" rel="nofollow noopener noreferrer" target="_blank">CentOS7使用systemctl添加自定义服务 - 简书</a> <strong>详细</strong></li>
<li><a href="https://stackoverflow.com/questions/40411338/how-stop-systemd-service" data-external="" rel="nofollow noopener noreferrer" target="_blank">linux - how stop systemd service - Stack Overflow</a></li>
<li><a href="https://www.cnblogs.com/saneri/p/7778756.html" data-external="" rel="nofollow noopener noreferrer" target="_blank">CentOS7利用systemctl添加自定义系统服务 - 梦徒 - 博客园</a></li>
<li><a href="https://www.freedesktop.org/software/systemd/man/systemd.service.html" data-external="" rel="nofollow noopener noreferrer" target="_blank">systemd.service 文档</a></li>
</ul>
</li>
</ul>  <footer data-pagefind-ignore data-astro-cid-vj2535pe>  <div class="admonition notice"> <span>Shared With License: CC-BY-4.0</span> <p> <span>Creative Commons Attribution 4.0 International</span> <a href="https://creativecommons.org/licenses/by/4.0/legalcode" target="_blank" rel="noopener noreferrer nofollow" class="license-link"> <span>view</span> </a> </p> </div>  </footer>  </article>   </div>   </main> </body></html>